-- Crear visat materializada
CREATE MATERIALIZED VIEW piezometria.mv_piezometro_inter_mbloque AS (
	SELECT DISTINCT
		ON (pz.id_piezometro) 
			pz.*,
			mb.geom_point mb_geom_point,
			mb.xcentre,
			mb.ycentre,
			mb.zcentre,
			mb.litologia,
			mb.alteracion,
			mb.minzone,
			mb.ucs,
			mb.rmr_adic,			
			ST_3DDistance (
			pz.pz_geom_point,
			mb.geom_point
		) AS distancia
	FROM
		"piezometria"."v_piezometro_geom_point" pz,
		modelo_bloques.v_modelo_bloques_geom_point mb
	WHERE
		ST_3DDistance (
			pz.pz_geom_point,
			mb.geom_point
		) < 50
	ORDER BY
		pz.id_piezometro,
		distancia
) WITH DATA;

-- Query para actualizar la vista materializada "mv_piezometro_inter_mbloque"
REFRESH MATERIALIZED VIEW piezometria.mv_piezometro_inter_mbloque;